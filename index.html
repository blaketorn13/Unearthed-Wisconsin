<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unearthed Wisconsin</title>

    <!-- React (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX in one file (Koder-friendly) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root{
        --bg:#0b1020;
        --card:rgba(255,255,255,.08);
        --card2:rgba(255,255,255,.06);
        --text:rgba(255,255,255,.92);
        --muted:rgba(255,255,255,.72);
        --line:rgba(255,255,255,.14);
        --accent:#8cffc7;
        --accent2:#61bbff;
        --warn:#ffd36b;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        background:
          radial-gradient(1200px 600px at 20% 0%, rgba(140, 255, 199, 0.12), transparent 60%),
          radial-gradient(1000px 600px at 80% 20%, rgba(97, 187, 255, 0.12), transparent 60%),
          var(--bg);
        color:var(--text);
      }
      .page{min-height:100%;display:flex;flex-direction:column}
      .topbar{
        position:sticky;top:0;z-index:10;
        display:flex;align-items:center;justify-content:space-between;
        padding:14px 18px;border-bottom:1px solid var(--line);
        backdrop-filter: blur(10px);
        background: rgba(11, 16, 32, 0.65);
      }
      .brand{display:flex;align-items:center;gap:10px}
      .brandDot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 0 0 4px rgba(140,255,199,.12)}
      .brandText{font-weight:800;letter-spacing:.2px}
      .navRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
      .navLink{
        color:var(--muted);text-decoration:none;border:1px solid var(--line);
        padding:8px 10px;border-radius:10px;display:inline-flex;gap:8px;align-items:center
      }
      .navLink:hover{color:var(--text);border-color:rgba(255,255,255,.28)}
      .content{
        width:min(980px, calc(100% - 32px));
        margin:18px auto 24px;flex:1;display:grid;gap:16px;
      }
      .card{
        border:1px solid var(--line);
        background: linear-gradient(180deg, var(--card), var(--card2));
        border-radius:18px;padding:18px;
        box-shadow:0 10px 30px rgba(0,0,0,.25);
      }
      .coverWrap{
        position:relative;width:min(420px,100%);margin:0 auto;
        border-radius:18px;overflow:hidden;border:1px solid var(--line);
        box-shadow:0 14px 40px rgba(0,0,0,.35);
      }
      .coverImg{width:100%;height:auto;display:block}

      /* Clickable icon hotspots */
      .hotspot{
        position:absolute;background:transparent;border:2px solid transparent;
        border-radius:14px;cursor:pointer;
      }
      .hotspot:hover{
        border-color: rgba(140, 255, 199, 0.9);
        box-shadow: 0 0 0 6px rgba(140, 255, 199, 0.14);
      }
      .hotspot:focus-visible{
        outline:none;
        border-color: rgba(97, 187, 255, 0.95);
        box-shadow: 0 0 0 6px rgba(97, 187, 255, 0.18);
      }

      /* Visited stamp overlay (non-clickable) */
      .stamp{
        position:absolute;
        pointer-events:none;
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:6px 10px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.18);
        background: rgba(0,0,0,.35);
        color: rgba(255,255,255,.90);
        font-size:12px;
        backdrop-filter: blur(6px);
      }
      .stampDot{
        width:8px;height:8px;border-radius:999px;
        background: var(--accent);
        box-shadow:0 0 0 4px rgba(140,255,199,.14);
      }

      .hint{
        border:1px solid var(--line);
        border-radius:18px;padding:14px 16px;
        background: rgba(255,255,255,.04);
      }
      .hintTitle{font-weight:700;margin-bottom:6px}
      .hintBody{color:var(--muted);line-height:1.45}
      .title{margin:0 0 6px;font-size:28px;letter-spacing:.2px}
      .subtitle{margin:0 0 14px;color:var(--muted);line-height:1.5}

      .panel{
        border:1px solid var(--line);
        background: rgba(0,0,0,.12);
        border-radius:16px;padding:14px;
      }
      .panel h2{margin:0 0 10px;font-size:16px;color:rgba(255,255,255,.88)}
      .btn{
        display:inline-flex;align-items:center;justify-content:center;
        padding:10px 12px;border-radius:12px;
        border:1px solid rgba(255,255,255,.18);
        background: rgba(255,255,255,.06);
        color:var(--text);text-decoration:none;cursor:pointer;
      }
      .btn:hover{border-color: rgba(140,255,199,.5); box-shadow:0 0 0 5px rgba(140,255,199,.12)}
      .btn:disabled{
        opacity:.5; cursor:not-allowed;
      }
      .btn2{
        border-color: rgba(97,187,255,.35);
      }
      .btn2:hover{
        border-color: rgba(97,187,255,.75);
        box-shadow:0 0 0 5px rgba(97,187,255,.14);
      }
      .footer{color:rgba(255,255,255,.55);text-align:center;padding:18px 10px 24px}
      .pill{
        display:inline-flex;align-items:center;gap:8px;
        padding:8px 10px;border:1px solid rgba(255,255,255,.16);
        border-radius:999px;background: rgba(255,255,255,.05);
        color:var(--muted);font-size:13px;
      }

      /* Checklist */
      .checklist{display:grid;gap:10px}
      .taskRow{
        display:flex;gap:10px;align-items:flex-start;
        padding:10px;
        border:1px solid rgba(255,255,255,.12);
        border-radius:14px;
        background: rgba(255,255,255,.03);
      }
      .taskRow input{margin-top:3px; transform: scale(1.1);}
      .taskText{color: rgba(255,255,255,.80); line-height:1.45}
      .taskDone .taskText{color: rgba(255,255,255,.62); text-decoration: line-through;}
      .groupTitle{
        margin-top:8px;
        font-weight:800;
        color: rgba(255,255,255,.88);
        letter-spacing:.2px;
      }
      .smallMuted{color: var(--muted); font-size:13px; line-height:1.45}

      /* Toolkit badges */
      .kitGrid{
        display:grid;
        grid-template-columns: 1fr;
        gap:10px;
      }
      @media (min-width: 720px){
        .kitGrid{grid-template-columns: 1fr 1fr;}
      }
      .kitItem{
        border:1px solid rgba(255,255,255,.14);
        border-radius:16px;
        background: rgba(255,255,255,.03);
        padding:12px;
        display:flex;
        gap:12px;
        align-items:flex-start;
      }
      .kitIcon{
        width:38px;height:38px;border-radius:12px;
        display:flex;align-items:center;justify-content:center;
        background: rgba(140,255,199,.10);
        border:1px solid rgba(140,255,199,.18);
        font-size:18px;
        flex: 0 0 auto;
      }
      .kitName{font-weight:900; letter-spacing:.2px}
      .kitDesc{color: rgba(255,255,255,.72); font-size:13px; line-height:1.45; margin-top:4px;}
      .tagRow{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap}
      .tag{
        display:inline-flex;
        align-items:center;
        gap:6px;
        padding:6px 10px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.14);
        background: rgba(0,0,0,.18);
        color: rgba(255,255,255,.78);
        font-size:12px;
      }
      .warnTag{
        border-color: rgba(255,211,107,.35);
        color: rgba(255,211,107,.95);
        background: rgba(255,211,107,.08);
      }
    </style>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel">
      // -----------------------------
      // Data
      // -----------------------------
      const LOCATIONS = [
        {
          id: "high-cliff",
          title: "High Cliff",
          short: "Dramatic views above Lake Winnebago and classic Wisconsin outdoor vibes.",
          hotspot: { left: 64, top: 6, width: 32, height: 14 },

          // Optional: you can add these later like we did for Lizard Mound:
          // mapUrl, facts, gallery, adventureTasks, toolkitItems
        },

        {
          id: "lizard-mound",
          title: "Lizard Mound",
          short: "One of the most well-preserved Native American effigy mound sites in the nation!",
          hotspot: { left: 70, top: 41, width: 24, height: 18 },

          mapUrl: "https://www.google.com/maps/dir//2121+Co+Hwy+A,+West+Bend,+WI+53090/@43.2802061,-88.4403709,13z/data=!4m8!4m7!1m0!1m5!1m1!1s0x8804f531fad36d19:0x8c43669079f0ac40!2m2!1d-88.1393647!2d43.463246?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoKLDEwMDc5MjA3M0gBUAM%3D",

          facts: [
            "Location: Farmington, WI",
            "Time Period: ~A.D. 700‚Äì1200 (Late Woodland)",
            "Lizard Mound has over 20 animal-shaped mounds, including lizards, birds, and bears.",
            "Some mounds align with the sun at certain times of the year.",
            "The mounds were built by the Late Woodland people for ceremonial purposes.",
            "Excavations show not all mounds were burials‚Äîsome were symbolic.",
            "One of the most well-preserved Native American effigy mound sites in the nation.",
            "28 distinct mounds are located at the site.",
            "Animal-shaped mounds may represent clan symbols or spiritual beliefs.",
            "Some lizard-shaped mounds stretch over 1,000 feet long.",
            "The site was first surveyed by archaeologists in the 1800s.",
            "The mounds are protected and sacred to Native American tribes today.",
          ],

          gallery: ["./LizardMoundMap.png", "./LizardMound.png"],

          // Adventure Lab tasks = CHECKLIST (saved progress)
          // group is just for display headings
          adventureLabTitle: "Adventure Lab",
          adventureTasks: [
            { id: "lm-animal-lizard", group: "Animal Mounds", text: "Find a lizard-shaped mound." },
            { id: "lm-animal-bird", group: "Animal Mounds", text: "Spot a bird-shaped mound." },
            { id: "lm-animal-bear", group: "Animal Mounds", text: "Look for a bear-shaped mound." },
            { id: "lm-sun-align", group: "Animal Mounds", text: "Notice which direction the mounds face‚Äîany line up with the sun?" },

            { id: "lm-cone", group: "Geometric Mounds", text: "Find a cone-shaped mound." },
            { id: "lm-straight", group: "Geometric Mounds", text: "Find a long, straight mound." },
            { id: "lm-imagine", group: "Geometric Mounds", text: "Imagine what the shapes were used for (ceremony? symbolic? burial?)." },

            { id: "lm-nature", group: "Nature Hunt", text: "Spot plants or wildlife around the mounds (look, don‚Äôt disturb)." },

            { id: "lm-sketch", group: "Field Notebook", text: "Sketch your favorite mound shape in your field notebook." },
          ],

          // Toolkit ‚Äúbadges‚Äù (earn + save)
          // These are archaeology-themed tool kit items.
          toolkitItems: [
            {
              id: "tool-field-notebook",
              name: "Field Notebook",
              icon: "üìì",
              description: "Your official place for sketches, notes, and questions like a junior archaeologist.",
              earnRule: "Complete the Field Notebook task.",
            },
            {
              id: "tool-compass",
              name: "Sun & Compass Reader",
              icon: "üß≠",
              description: "You noticed direction and alignment‚Äîexactly how archaeologists read landscapes.",
              earnRule: "Complete the sun/alignment task.",
            },
            {
              id: "tool-site-respect",
              name: "Site Respect Seal",
              icon: "ü™∂",
              description: "You explored carefully and respectfully. These places are protected and sacred.",
              earnRule: "Earned when you finish the whole Adventure Lab checklist.",
            },
          ],
        },

        {
          id: "pike-lake",
          title: "Pike Lake",
          short: "A southeast Wisconsin lake stop‚Äîgreat for nature breaks and looped adventures.",
          hotspot: { left: 33, top: 47, width: 38, height: 20 },
        },
        {
          id: "aztalan-state-park",
          title: "Aztalan State Park",
          short: "One of Wisconsin‚Äôs most famous ancient places‚Äîan iconic archaeological site.",
          hotspot: { left: 7, top: 56, width: 28, height: 16 },
        },
        {
          id: "koshkonong-effigy-mounds",
          title: "Koshkonong Effigy Mounds",
          short: "An effigy mound area‚Äîgreat for learning how landscapes can be ‚Äòwritten‚Äô with earthworks.",
          hotspot: { left: 8, top: 83, width: 44, height: 16 },
        },
      ];

      function getLoc(id){ return LOCATIONS.find(l => l.id === id); }

      // -----------------------------
      // Storage helpers (saves progress)
      // -----------------------------
      const STORAGE_KEY = "uw_progress_v1";

      function loadProgress(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(!raw) return { visited: {}, tasks: {}, toolkit: {} };
          const parsed = JSON.parse(raw);
          return {
            visited: parsed.visited || {},
            tasks: parsed.tasks || {},     // tasks[locId][taskId] = true/false
            toolkit: parsed.toolkit || {}, // toolkit[itemId] = { earnedAt, earnedFrom }
          };
        }catch(e){
          return { visited: {}, tasks: {}, toolkit: {} };
        }
      }

      function saveProgress(next){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(next));
      }

      function useProgress(){
        const [progress, setProgress] = React.useState(loadProgress());

        const update = (fn) => {
          setProgress(prev => {
            const next = fn(structuredClone(prev));
            saveProgress(next);
            return next;
          });
        };

        return [progress, update];
      }

      // -----------------------------
      // Simple ‚Äúrouting‚Äù using hash
      // #/  -> cover
      // #/location/:id
      // #/toolkit
      // -----------------------------
      function useHashRoute(){
        const [hash, setHash] = React.useState(window.location.hash || "#/");
        React.useEffect(() => {
          const onChange = () => setHash(window.location.hash || "#/");
          window.addEventListener("hashchange", onChange);
          return () => window.removeEventListener("hashchange", onChange);
        }, []);
        return [hash, (next) => { window.location.hash = next; }];
      }

      // -----------------------------
      // UI Components
      // -----------------------------
      function Cover({ progress }){
        const [, nav] = useHashRoute();

        return (
          <div className="page">
            <header className="topbar">
              <div className="brand">
                <span className="brandDot" />
                <span className="brandText">Unearthed Wisconsin</span>
              </div>

              <div className="navRow">
                <a className="navLink" href="#/toolkit">üß∞ Toolkit</a>
                <span className="pill">Game Map ‚Ä¢ Tap an icon</span>
              </div>
            </header>

            <main className="content">
              <div className="coverWrap" aria-label="Unearthed Wisconsin cover map">
                <img className="coverImg" src="./cover.png" alt="Unearthed Wisconsin map cover" />

                {LOCATIONS.map(loc => (
                  <React.Fragment key={loc.id}>
                    <button
                      className="hotspot"
                      style={{
                        left: `${loc.hotspot.left}%`,
                        top: `${loc.hotspot.top}%`,
                        width: `${loc.hotspot.width}%`,
                        height: `${loc.hotspot.height}%`,
                      }}
                      onClick={() => nav(`#/location/${loc.id}`)}
                      aria-label={`Open ${loc.title}`}
                      title={loc.title}
                    />

                    {/* Visited stamp */}
                    {progress.visited?.[loc.id] ? (
                      <div
                        className="stamp"
                        style={{
                          left: `calc(${loc.hotspot.left}% + 2px)`,
                          top: `calc(${loc.hotspot.top}% - 10px)`,
                        }}
                      >
                        <span className="stampDot"></span>
                        Visited
                      </div>
                    ) : null}
                  </React.Fragment>
                ))}
              </div>

              <div className="hint">
                <div className="hintTitle">How to play</div>
                <div className="hintBody">
                  Tap a site icon to explore. Complete the <strong>Adventure Lab</strong> checklist to
                  earn archaeology tool kit items. Your progress saves automatically on this device.
                </div>
              </div>
            </main>

            <footer className="footer">Unearthed Wisconsin ‚Ä¢ Game Build</footer>
          </div>
        );
      }

      function ToolkitPage({ progress, update }){
        const earnedIds = Object.keys(progress.toolkit || {});
        const earnedItems = [];

        // Collect items from all locations
        LOCATIONS.forEach(loc => {
          (loc.toolkitItems || []).forEach(item => {
            if(progress.toolkit?.[item.id]){
              earnedItems.push({
                ...item,
                earnedAt: progress.toolkit[item.id].earnedAt,
                earnedFrom: progress.toolkit[item.id].earnedFrom,
              });
            }
          });
        });

        const resetAll = () => {
          if(!confirm("Reset all saved progress on this device?")) return;
          const empty = { visited: {}, tasks: {}, toolkit: {} };
          saveProgress(empty);
          update(() => empty);
        };

        return (
          <div className="page">
            <header className="topbar">
              <div className="brand">
                <span className="brandDot" />
                <span className="brandText">Unearthed Wisconsin</span>
              </div>
              <div className="navRow">
                <a className="navLink" href="#/">‚Üê Map</a>
                <button className="btn btn2" type="button" onClick={resetAll}>‚ôªÔ∏è Reset Progress</button>
              </div>
            </header>

            <main className="content">
              <div className="card">
                <h1 className="title">üß∞ Archaeology Tool Kit</h1>
                <p className="subtitle">
                  Every tool you earn gets added here. Complete Adventure Labs to build your kit!
                </p>

                <div className="panel">
                  <div className="tagRow">
                    <span className="tag">Visited sites: <strong>{Object.keys(progress.visited || {}).length}</strong></span>
                    <span className="tag">Tools earned: <strong>{earnedIds.length}</strong></span>
                    {earnedIds.length === 0 ? <span className="tag warnTag">No tools earned yet ‚Äî explore a site!</span> : null}
                  </div>
                </div>

                <div className="panel" style={{marginTop:14}}>
                  <h2>Your earned tools</h2>

                  {earnedItems.length ? (
                    <div className="kitGrid">
                      {earnedItems.map(item => (
                        <div key={item.id} className="kitItem">
                          <div className="kitIcon">{item.icon}</div>
                          <div>
                            <div className="kitName">{item.name}</div>
                            <div className="kitDesc">{item.description}</div>
                            <div className="tagRow">
                              <span className="tag">Earned at: <strong>{new Date(item.earnedAt).toLocaleString()}</strong></span>
                              <span className="tag">From: <strong>{item.earnedFrom}</strong></span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <div className="smallMuted">No tools earned yet. Open a location and complete the Adventure Lab checklist.</div>
                  )}
                </div>
              </div>
            </main>

            <footer className="footer">Unearthed Wisconsin</footer>
          </div>
        );
      }

      function LocationPage({ id, progress, update }){
        const loc = getLoc(id);

        React.useEffect(() => {
          if(!loc) return;
          // mark visited when you open the page
          update(p => {
            p.visited = p.visited || {};
            p.visited[loc.id] = true;
            return p;
          });
        }, [id]);

        if(!loc){
          return (
            <div className="page">
              <header className="topbar">
                <div className="brand">
                  <span className="brandDot" />
                  <span className="brandText">Unearthed Wisconsin</span>
                </div>
                <a className="navLink" href="#/">‚Üê Map</a>
              </header>
              <main className="content">
                <div className="card">
                  <h1>Location not found</h1>
                  <p className="subtitle">That stop isn‚Äôt in the list yet.</p>
                  <a className="btn" href="#/">Back to map</a>
                </div>
              </main>
            </div>
          );
        }

        // Task helpers
        const tasks = loc.adventureTasks || [];
        const taskStateForLoc = (progress.tasks && progress.tasks[loc.id]) ? progress.tasks[loc.id] : {};
        const completedCount = tasks.filter(t => taskStateForLoc[t.id]).length;
        const totalCount = tasks.length;
        const allDone = totalCount > 0 && completedCount === totalCount;

        const toggleTask = (taskId) => {
          update(p => {
            p.tasks = p.tasks || {};
            p.tasks[loc.id] = p.tasks[loc.id] || {};
            p.tasks[loc.id][taskId] = !p.tasks[loc.id][taskId];
            return p;
          });
        };

        // Earning toolkit items (archaeology-themed badges)
        const toolkitItems = loc.toolkitItems || [];
        const earnedToolkit = progress.toolkit || {};

        const earnToolkitItem = (itemId) => {
          const item = toolkitItems.find(x => x.id === itemId);
          if(!item) return;

          // simple earn rules tied to tasks:
          // - Field Notebook = requires "lm-sketch"
          // - Sun & Compass Reader = requires "lm-sun-align"
          // - Site Respect Seal = requires allDone
          const canEarn = (() => {
            if(itemId === "tool-field-notebook") return !!taskStateForLoc["lm-sketch"];
            if(itemId === "tool-compass") return !!taskStateForLoc["lm-sun-align"];
            if(itemId === "tool-site-respect") return allDone;
            return allDone;
          })();

          if(!canEarn) return;

          update(p => {
            p.toolkit = p.toolkit || {};
            if(!p.toolkit[itemId]){
              p.toolkit[itemId] = { earnedAt: Date.now(), earnedFrom: loc.title };
            }
            return p;
          });
        };

        // Group tasks for display
        const groups = [];
        tasks.forEach(t => {
          const g = t.group || "Adventure";
          if(!groups.includes(g)) groups.push(g);
        });

        return (
          <div className="page">
            <header className="topbar">
              <div className="brand">
                <span className="brandDot" />
                <span className="brandText">Unearthed Wisconsin</span>
              </div>

              <div className="navRow">
                <a className="navLink" href="#/">‚Üê Map</a>
                <a className="navLink" href="#/toolkit">üß∞ Toolkit</a>
              </div>
            </header>

            <main className="content">
              <div className="card">
                <h1 className="title">{loc.title}</h1>
                <p className="subtitle">{loc.short}</p>

                {/* Driving directions */}
                {loc.mapUrl ? (
                  <div style={{marginTop: 10, marginBottom: 10, display: "flex", gap: 10, flexWrap: "wrap"}}>
                    {/* Use button navigation (works better in iPad previews) */}
                    <button
                      className="btn"
                      type="button"
                      onClick={() => { window.location.href = loc.mapUrl; }}
                    >
                      üöó Open Driving Directions
                    </button>
                  </div>
                ) : null}

                {/* Facts */}
                {loc.facts?.length ? (
                  <section className="panel">
                    <h2>Facts</h2>
                    <ul style={{margin: 0, paddingLeft: 18, lineHeight: 1.6}}>
                      {loc.facts.map((fact, index) => (
                        <li key={index} style={{color: "rgba(255,255,255,.78)"}}>
                          {fact}
                        </li>
                      ))}
                    </ul>
                  </section>
                ) : null}

                {/* Pictures */}
                {loc.gallery?.length ? (
                  <section className="panel" style={{marginTop: 14}}>
                    <h2>Pictures</h2>
                    <div style={{display:"grid", gap:10, gridTemplateColumns:"repeat(2, minmax(0, 1fr))"}}>
                      {loc.gallery.map((src) => (
                        <img
                          key={src}
                          src={src}
                          alt={`${loc.title} photo`}
                          style={{width:"100%", borderRadius:12, border:"1px solid rgba(255,255,255,.14)"}}
                        />
                      ))}
                    </div>
                  </section>
                ) : null}

                {/* Adventure Lab Checklist */}
                {tasks.length ? (
                  <section className="panel" style={{marginTop: 14}}>
                    <div style={{display:"flex", justifyContent:"space-between", alignItems:"baseline", gap:10, flexWrap:"wrap"}}>
                      <h2>{loc.adventureLabTitle || "Adventure Lab"}</h2>
                      <span className="pill">Progress: {completedCount}/{totalCount}</span>
                    </div>

                    <div className="smallMuted" style={{marginBottom:10}}>
                      Check items as you complete them ‚Äî this saves automatically on this device.
                    </div>

                    <div className="checklist">
                      {groups.map(group => (
                        <div key={group}>
                          <div className="groupTitle">{group}</div>
                          <div className="checklist" style={{marginTop:8}}>
                            {tasks.filter(t => (t.group || "Adventure") === group).map(t => {
                              const done = !!taskStateForLoc[t.id];
                              return (
                                <label key={t.id} className={"taskRow" + (done ? " taskDone" : "")}>
                                  <input
                                    type="checkbox"
                                    checked={done}
                                    onChange={() => toggleTask(t.id)}
                                  />
                                  <div className="taskText">{t.text}</div>
                                </label>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </div>
                  </section>
                ) : null}

                {/* Earn toolkit items (badges) */}
                {toolkitItems.length ? (
                  <section className="panel" style={{marginTop: 14}}>
                    <h2>üß∞ Earn Tool Kit Items</h2>
                    <div className="smallMuted" style={{marginBottom:10}}>
                      Earn items by completing the Adventure Lab. Your tool kit saves automatically.
                    </div>

                    <div className="kitGrid">
                      {toolkitItems.map(item => {
                        const already = !!earnedToolkit[item.id];

                        // Determine if eligible for this item (based on our simple rules above)
                        const eligible = (() => {
                          if(item.id === "tool-field-notebook") return !!taskStateForLoc["lm-sketch"];
                          if(item.id === "tool-compass") return !!taskStateForLoc["lm-sun-align"];
                          if(item.id === "tool-site-respect") return allDone;
                          return allDone;
                        })();

                        return (
                          <div key={item.id} className="kitItem">
                            <div className="kitIcon">{item.icon}</div>
                            <div style={{flex:1}}>
                              <div className="kitName">{item.name}</div>
                              <div className="kitDesc">{item.description}</div>
                              <div className="tagRow">
                                <span className="tag">How to earn: <strong>{item.earnRule}</strong></span>
                                {already ? <span className="tag">‚úÖ Earned</span> : (eligible ? <span className="tag">Ready to earn</span> : <span className="tag warnTag">Not yet</span>)}
                              </div>

                              <div style={{marginTop:10, display:"flex", gap:10, flexWrap:"wrap"}}>
                                <button
                                  className="btn btn2"
                                  type="button"
                                  onClick={() => earnToolkitItem(item.id)}
                                  disabled={already || !eligible}
                                >
                                  {already ? "Earned" : "üèÖ Earn this item"}
                                </button>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>

                    {allDone ? (
                      <div className="smallMuted" style={{marginTop:10}}>
                        Nice work ‚Äî Adventure Lab complete! üèÅ
                      </div>
                    ) : null}
                  </section>
                ) : null}

                <div style={{marginTop:16, display:"flex", gap:10, flexWrap:"wrap"}}>
                  <a className="btn" href="#/">Back to map</a>
                  <a className="btn btn2" href="#/toolkit">View Tool Kit</a>
                </div>
              </div>
            </main>

            <footer className="footer">Unearthed Wisconsin</footer>
          </div>
        );
      }

      // -----------------------------
      // App
      // -----------------------------
      function App(){
        const [hash] = useHashRoute();
        const [progress, update] = useProgress();

        // Parse route
        const cleaned = (hash || "#/").replace(/^#/, "");
        const parts = cleaned.split("/").filter(Boolean);

        if(parts.length === 0) return <Cover progress={progress} />;
        if(parts[0] === "location" && parts[1]) return <LocationPage id={parts[1]} progress={progress} update={update} />;
        if(parts[0] === "toolkit") return <ToolkitPage progress={progress} update={update} />;

        return <Cover progress={progress} />;
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>






